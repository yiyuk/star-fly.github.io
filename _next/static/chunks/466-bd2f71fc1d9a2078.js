"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[466],{5970:function(e,a,n){n.d(a,{Rs:function(){return r},ey:function(){return s},is:function(){return l},zX:function(){return o}});let r=(e,a,n)=>{window.addEventListener("resize",()=>{console.log("resize"),e.width=window.innerWidth,e.height=window.innerHeight,a.aspect=e.width/e.height,a.updateProjectionMatrix(),n.setSize(e.width,e.height),n.setPixelRatio(Math.min(window.devicePixelRatio,2))})},t=e=>{let a=document.fullscreenElement||document.webkitFullscreenElement;a?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen()},s=e=>{window.addEventListener("dblclick",()=>{t(e)})},l=(e,a)=>{let n=Math.min(e,a);return Math.random()*(Math.max(e,a)-n)+n};function o(e,a){var n=!1;"#"==e[0]&&(e=e.slice(1),n=!0);var r=parseInt(e,16),t=(r>>16)+a;t>255?t=255:t<0&&(t=0);var s=(r>>8&255)+a;s>255?s=255:s<0&&(s=0);var l=(255&r)+a;return l>255?l=255:l<0&&(l=0),(n?"#":"")+(l|s<<8|t<<16).toString(16)}},4261:function(e,a,n){n.r(a),n.d(a,{StarBoard:function(){return r},StarChannel:function(){return t},StarRoute:function(){return s},chessData:function(){return d},default:function(){return y},dicePosiston:function(){return l},gameData:function(){return i},homeIndex:function(){return o}});let r=[{index:0,x:85,y:63,angle:270,player:3,chess:[]},{index:1,x:79,y:65,angle:270,player:0,chess:[]},{index:2,x:73.5,y:65,angle:270,player:1,chess:[]},{index:3,x:67.5,y:63,angle:270,player:2,chess:[]},{index:4,x:63,y:67.5,angle:180,player:3,chess:[]},{index:5,x:65,y:73.5,angle:180,player:0,chess:[]},{index:6,x:65,y:79,angle:180,player:1,chess:[]},{index:7,x:63,y:85,angle:180,player:2,chess:[]},{index:8,x:57,y:87,angle:270,player:3,chess:[]},{index:9,x:51.5,y:87,angle:270,player:0,chess:[]},{index:10,x:46,y:87,angle:270,player:1,chess:[]},{index:11,x:40.5,y:87,angle:270,player:2,chess:[]},{index:12,x:35,y:87,angle:270,player:3,chess:[]},{index:13,x:29.5,y:85,angle:0,player:0,chess:[]},{index:14,x:27,y:79,angle:0,player:1,chess:[]},{index:15,x:27,y:73.5,angle:0,player:2,chess:[]},{index:16,x:29.5,y:68,angle:0,player:3,chess:[]},{index:17,x:24.5,y:63,angle:270,player:0,chess:[]},{index:18,x:18.5,y:65,angle:270,player:1,chess:[]},{index:19,x:13,y:65,angle:270,player:2,chess:[]},{index:20,x:7.5,y:62.5,angle:270,player:3,chess:[]},{index:21,x:5.5,y:57,angle:0,player:0,chess:[]},{index:22,x:5.5,y:51.5,angle:0,player:1,chess:[]},{index:23,x:5.5,y:46.5,angle:0,player:2,chess:[]},{index:24,x:5.5,y:41,angle:0,player:3,chess:[]},{index:25,x:5.5,y:35.5,angle:0,player:0,chess:[]},{index:26,x:7.5,y:29.5,angle:90,player:1,chess:[]},{index:27,x:13,y:27.5,angle:90,player:2,chess:[]},{index:28,x:18.5,y:27.5,angle:90,player:3,chess:[]},{index:29,x:24.5,y:29.5,angle:90,player:0,chess:[]},{index:30,x:29.5,y:25,angle:0,player:1,chess:[]},{index:31,x:27,y:19,angle:0,player:2,chess:[]},{index:32,x:27,y:13.5,angle:0,player:3,chess:[]},{index:33,x:29,y:7.5,angle:0,player:0,chess:[]},{index:34,x:35,y:5.5,angle:90,player:1,chess:[]},{index:35,x:41,y:5.5,angle:90,player:2,chess:[]},{index:36,x:46,y:5.5,angle:90,player:3,chess:[]},{index:37,x:51.5,y:5.5,angle:90,player:0,chess:[]},{index:38,x:57,y:5.5,angle:90,player:1,chess:[]},{index:39,x:63,y:7.5,angle:180,player:2,chess:[]},{index:40,x:65,y:13.5,angle:180,player:3,chess:[]},{index:41,x:65,y:19,angle:180,player:0,chess:[]},{index:42,x:63,y:25,angle:180,player:1,chess:[]},{index:43,x:67.5,y:29.5,angle:90,player:2,chess:[]},{index:44,x:73.5,y:27.5,angle:90,player:3,chess:[]},{index:45,x:79,y:27.5,angle:90,player:0,chess:[]},{index:46,x:85,y:29.5,angle:90,player:1,chess:[]},{index:47,x:87,y:35.5,angle:180,player:2,chess:[]},{index:48,x:87,y:41,angle:180,player:3,chess:[]},{index:49,x:87,y:46,angle:180,player:0,chess:[]},{index:50,x:87,y:51.5,angle:180,player:1,chess:[]},{index:51,x:87,y:57,angle:180,player:2,chess:[]},{index:52,x:79,y:46,angle:270,player:0,chess:[]},{index:53,x:73.5,y:46,angle:270,player:0,chess:[]},{index:54,x:68,y:46,angle:270,player:0,chess:[]},{index:55,x:62.5,y:46,angle:270,player:0,chess:[]},{index:56,x:57,y:46,angle:270,player:0,chess:[]},{index:57,x:51.5,y:46,angle:270,player:0,chess:[]},{index:58,x:46.2,y:79,angle:0,player:1,chess:[]},{index:59,x:46.2,y:73.5,angle:0,player:1,chess:[]},{index:60,x:46.2,y:68,angle:0,player:1,chess:[]},{index:61,x:46.2,y:62.5,angle:0,player:1,chess:[]},{index:62,x:46.2,y:57.3,angle:0,player:1,chess:[]},{index:63,x:46.2,y:51.5,angle:0,player:1,chess:[]},{index:64,x:13.3,y:46,angle:90,player:2,chess:[]},{index:65,x:18.7,y:46,angle:90,player:2,chess:[]},{index:66,x:24,y:46,angle:90,player:2,chess:[]},{index:67,x:29.7,y:46,angle:90,player:2,chess:[]},{index:68,x:35,y:46,angle:90,player:2,chess:[]},{index:69,x:41,y:46,angle:90,player:2,chess:[]},{index:70,x:46.2,y:13.5,angle:180,player:3,chess:[]},{index:71,x:46.2,y:18.7,angle:180,player:3,chess:[]},{index:72,x:46.2,y:24.1,angle:180,player:3,chess:[]},{index:73,x:46.2,y:29.5,angle:180,player:3,chess:[]},{index:74,x:46.2,y:35,angle:180,player:3,chess:[]},{index:75,x:46.2,y:41,angle:180,player:3,chess:[]},{index:76,x:92.5,y:66.8,angle:270,player:0,chess:[]},{index:77,x:78.15,y:78.35,angle:270,player:0,chess:[]},{index:78,x:78.15,y:86.6,angle:270,player:0,chess:[]},{index:79,x:86.65,y:78.35,angle:270,player:0,chess:[]},{index:80,x:86.55,y:86.5,angle:270,player:0,chess:[]},{index:81,x:25.5,y:92.5,angle:0,player:1,chess:[]},{index:82,x:5.8,y:78.2,angle:0,player:1,chess:[]},{index:83,x:5.8,y:86.5,angle:0,player:1,chess:[]},{index:84,x:14.1,y:78.1,angle:0,player:1,chess:[]},{index:85,x:14.1,y:86.4,angle:0,player:1,chess:[]},{index:86,x:0,y:25.6,angle:90,player:2,chess:[]},{index:87,x:5.7,y:5.8,angle:90,player:2,chess:[]},{index:88,x:5.7,y:13.9,angle:90,player:2,chess:[]},{index:89,x:14.1,y:5.8,angle:90,player:2,chess:[]},{index:90,x:14.1,y:13.8,angle:90,player:2,chess:[]},{index:91,x:66.8,y:0,angle:180,player:3,chess:[]},{index:92,x:78.3,y:5.6,angle:180,player:3,chess:[]},{index:93,x:78.3,y:14.1,angle:180,player:3,chess:[]},{index:94,x:86.55,y:5.6,angle:180,player:3,chess:[]},{index:95,x:86.45,y:14.1,angle:180,player:3,chess:[]}],t=[[17,30,43,4],[29,42,3,16]],s=[[76,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,52,53,54,55,56,57],[81,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,1,2,3,4,5,6,7,8,9,10,58,59,60,61,62,63],[86,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,64,65,66,67,68,69],[91,39,40,41,42,43,44,45,46,47,48,49,50,51,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,70,71,72,73,74,75]],l=[{x:.4,y:.8},{x:-1.8,y:.8},{x:-1.8,y:-1.2},{x:.4,y:-1.2}],o=[77,78,79,80,82,83,84,85,87,88,89,90,92,93,94,95],i={state:"start",currentPlayer:1,dice:0,round:0,currentStar:-1,touchStar:-1},d=[{index:77,player:0,state:"home"},{index:78,player:0,state:"home"},{index:79,player:0,state:"home"},{index:80,player:0,state:"home"},{index:82,player:1,state:"home"},{index:83,player:1,state:"home"},{index:84,player:1,state:"home"},{index:85,player:1,state:"home"},{index:87,player:2,state:"home"},{index:88,player:2,state:"home"},{index:89,player:2,state:"home"},{index:90,player:2,state:"home"},{index:92,player:3,state:"home"},{index:93,player:3,state:"home"},{index:94,player:3,state:"home"},{index:95,player:3,state:"home"}];function y(){}},2466:function(e,a,n){n.r(a);var r=n(5893),t=n(9477),s=n(9365),l=n(7637),o=n(5970),i=n(7294),d=n(4261);let y=()=>(console.log("StarFlyChess"),(0,i.useEffect)(()=>{let e,a,n,r,i,y,c,h,x;console.log("useEffect");let p=document.querySelector("#mainCanvas"),g=new t.xsS,u={width:window.innerWidth,height:window.innerHeight},m=new t.cPb(75,u.width/u.height,.1,100);m.position.set(0,0,8),new s.z(m,p);let D={count:500,size:.02,radius:3,randomness:.2,randomnessPower:4,sceneColor:"#000000",player0Color:"#ff6030",player1Color:"#3de93a",player2Color:"#ffbb00",player3Color:"#0062ff",playerColor:["#ff6030","#3de93a","#ffbb00","#0062ff"],playerTouchColor:[(0,o.zX)("#ff6030",70),(0,o.zX)("#3de93a",70),(0,o.zX)("#ffbb00",70),(0,o.zX)("#0062ff",70)]};g.background=new t.Ilk(D.sceneColor);let f=new t.Ilk("#ffffff");function w(){n&&(e.dispose(),a.dispose(),g.remove(n)),e=new t.u9r;var r=d.StarBoard.length;let s=new Float32Array(D.count*(r+4)*3),l=new Float32Array(D.count*(r+4)*3);for(let e=0;e<r;e++)for(let a=0;a<D.count;a++){let n=(e*D.count+a)*3;var i=new t.Ilk(D.playerColor[d.StarBoard[e].player]);i.lerp(f,(0,o.is)(0,.1)),a%2==0?(s[n]=d.StarBoard[e].x/10-5+(0,o.is)(0,.3)*(.5>Math.random()?1:-1),s[n+1]=d.StarBoard[e].y/10-5+(0,o.is)(.22,.3)*(.5>Math.random()?1:-1)):(s[n]=d.StarBoard[e].x/10-5+(0,o.is)(.22,.3)*(.5>Math.random()?1:-1),s[n+1]=d.StarBoard[e].y/10-5+(0,o.is)(0,.3)*(.5>Math.random()?1:-1)),s[n+2]=0,l[n]=i.r,l[n+1]=i.g,l[n+2]=i.b}for(let e=0;e<4;e++)for(let a=0;a<D.count;a++){let n=((e+r)*D.count+a)*3;var i=new t.Ilk(D.playerColor[e]);if(d.StarBoard[d.StarChannel[0][e]].x===d.StarBoard[d.StarChannel[1][e]].x){s[n]=d.StarBoard[d.StarChannel[0][e]].x/10-5+(0,o.is)(-.2,.2);let a=d.StarBoard[d.StarChannel[0][e]].y/10-5,r=d.StarBoard[d.StarChannel[1][e]].y/10-5;s[n+1]=(0,o.is)(a+(a<0?.3:-.3),r+(r<0?.3:-.3)),i.lerp(f,1-Math.abs(2*s[n+1]/(a-r)))}else{let a=d.StarBoard[d.StarChannel[0][e]].x/10-5,r=d.StarBoard[d.StarChannel[1][e]].x/10-5;s[n]=(0,o.is)(a+(a<0?.3:-.3),r+(r<0?.3:-.3)),s[n+1]=d.StarBoard[d.StarChannel[0][e]].y/10-5+(0,o.is)(-.2,.2),i.lerp(f,1-Math.abs(2*s[n]/(a-r)))}s[n+2]=Math.random()**D.randomnessPower*(.5>Math.random()?1:-1)*D.randomness*Math.random()*D.radius,l[n]=i.r,l[n+1]=i.g,l[n+2]=i.b}e.setAttribute("position",new t.TlE(s,3)),e.setAttribute("color",new t.TlE(l,3)),a=new t.UY4({size:D.size,sizeAttenuation:!0,depthWrite:!1,blending:t.WMw,vertexColors:!0}),n=new t.woe(e,a),g.add(n)}function C(){y&&(r.dispose(),i.dispose(),g.remove(y)),r=new t.u9r;let e=new Float32Array(48*D.count),a=new Float32Array(48*D.count);for(let r=0;r<16;r++)for(let s=0;s<D.count;s++){let l=(r*D.count+s)*3,i=Math.random()*D.radius;var n=new t.Ilk(D.playerColor[d.chessData[r].player]);"end"===d.chessData[r].state?n.lerp(f,1):d.gameData.touchStar===r?n.lerp(new t.Ilk(D.playerTouchColor[d.chessData[r].player]),1):n.lerp(f,(0,o.is)(0,.1)),e[l]=d.StarBoard[d.chessData[r].index].x/10-5+Math.random()**D.randomnessPower*(.5>Math.random()?1:-1)*D.randomness*i/2,e[l+1]=d.StarBoard[d.chessData[r].index].y/10-5+Math.random()**D.randomnessPower*(.5>Math.random()?1:-1)*D.randomness*i/2,e[l+2]=Math.random()**D.randomnessPower*(.5>Math.random()?1:-1)*D.randomness*i/3,a[l]=n.r,a[l+1]=n.g,a[l+2]=n.b}r.setAttribute("position",new t.TlE(e,3)),r.setAttribute("color",new t.TlE(a,3)),i=new t.UY4({size:D.size,sizeAttenuation:!0,depthWrite:!1,blending:t.WMw,vertexColors:!0}),y=new t.woe(r,i),g.add(y)}function S(e){if("mouseup"===e.type&&"dice"===d.gameData.state){(function(){if(d.gameData.dice=Math.floor((0,o.is)(1,7)),d.gameData.state="fly",function(){x&&(c.dispose(),h.dispose(),g.remove(x)),c=new t.u9r;let e=new Float32Array(18*D.count),a=new Float32Array(18*D.count);for(let r=0;r<d.gameData.dice;r++)for(let s=0;s<D.count;s++){let l=(r*D.count+s)*3,i=Math.random()*D.radius;var n=new t.Ilk(D.playerColor[d.gameData.currentPlayer]);n.lerp(f,(0,o.is)(0,.2)),e[l]=d.dicePosiston[d.gameData.currentPlayer].x+(r>2?.4*r-1.2:.4*r)+Math.random()**D.randomnessPower*(.5>Math.random()?1:-1)*D.randomness*i/5,e[l+1]=d.dicePosiston[d.gameData.currentPlayer].y+(r>2?-.4:0)+Math.random()**D.randomnessPower*(.5>Math.random()?1:-1)*D.randomness*i/5,e[l+2]=0,a[l]=n.r,a[l+1]=n.g,a[l+2]=n.b}c.setAttribute("position",new t.TlE(e,3)),c.setAttribute("color",new t.TlE(a,3)),h=new t.UY4({size:D.size,sizeAttenuation:!0,depthWrite:!1,blending:t.WMw,vertexColors:!0}),x=new t.woe(c,h),g.add(x)}(),console.log("投掷完毕，等待p"+d.gameData.currentPlayer+"行棋"),d.gameData.dice<6){let e=0;for(let a=0;a<4;a++)("home"===d.chessData[4*d.gameData.currentPlayer+a].state||"end"===d.chessData[4*d.gameData.currentPlayer+a].state)&&e++;e>3&&(v(0),console.log("p"+d.gameData.currentPlayer+"不可行棋"))}})();return}let a=-((e.clientX-p.clientWidth/2)/(p.clientHeight/2)*(m.position.z/Math.tan(90-m.getEffectiveFOV()/2))),n=-(-(e.clientY-p.clientHeight/2)/(p.clientHeight/2)*(m.position.z/Math.tan(90-m.getEffectiveFOV()/2)));d.gameData.touchStar=-1;for(let r=0;r<16;r++){let t=d.StarBoard[d.chessData[r].index].x/10-5,s=d.StarBoard[d.chessData[r].index].y/10-5;a<t+.3&&a>t-.3&&n<s+.3&&n>s-.3&&(d.gameData.touchStar=r,"mouseup"===e.type&&"fly"===d.gameData.state&&function(e){if(d.chessData[e].player!==d.gameData.currentPlayer||"end"===d.chessData[e].state){console.log("棋子不可行动");return}if("home"===d.chessData[e].state){if(6===d.gameData.dice)d.chessData[e].index=d.StarRoute[d.gameData.currentPlayer][0],d.chessData[e].state="start",d.gameData.state="dice",console.log("等待p"+d.gameData.currentPlayer+"再次投骰子");else{console.log("棋子不可行动");return}}else{let a=d.StarRoute[d.gameData.currentPlayer].length,n=d.StarRoute[d.gameData.currentPlayer].indexOf(d.chessData[e].index)+d.gameData.dice;d.chessData[e].state="fly",n>a?(console.log(d.chessData[e]),d.chessData[e].state="end",d.chessData[e].index=d.homeIndex[e],console.log(d.chessData[e])):(d.chessData[e].index=d.StarRoute[d.gameData.currentPlayer][n],d.chessData[e].index===d.StarChannel[0][d.chessData[e].player]?(d.chessData[e].index=d.StarChannel[1][d.chessData[e].player],d.chessData[e].index<52&&d.StarBoard[d.chessData[e].index].player===d.chessData[e].player&&(d.chessData[e].index=d.StarRoute[d.gameData.currentPlayer][d.StarRoute[d.gameData.currentPlayer].indexOf(d.chessData[e].index)+4])):d.chessData[e].index<52&&d.StarBoard[d.chessData[e].index].player===d.chessData[e].player&&(d.chessData[e].index=d.StarRoute[d.gameData.currentPlayer][d.StarRoute[d.gameData.currentPlayer].indexOf(d.chessData[e].index)+4],d.chessData[e].index===d.StarChannel[0][d.chessData[e].player]&&(d.chessData[e].index=d.StarChannel[1][d.chessData[e].player])));for(let a=0;a<16;a++)d.chessData[a].player!==d.gameData.currentPlayer&&d.chessData[a].index===d.chessData[e].index&&(console.log("p"+d.gameData.currentPlayer+"击毁p"+d.chessData[a].player+"的棋子"),d.chessData[a].index=d.homeIndex[a]);d.gameData.dice<6||P()?v(0):(d.gameData.state="dice",console.log("等待p"+d.gameData.currentPlayer+"再次投骰子"))}C()}(r))}}function P(){let e=0;for(let a=0;a<4;a++)"end"===d.chessData[4*d.gameData.currentPlayer+a].state&&e++;return e>3}function v(e){e>3&&(console.log("游戏结束！"),d.gameData.state="end"),d.gameData.state="dice",d.gameData.currentPlayer++,d.gameData.currentPlayer>3&&(d.gameData.currentPlayer=0,d.gameData.round++),P()&&v(e),console.log("等待p"+d.gameData.currentPlayer+"投骰子")}w(),C(),d.gameData.state="dice";let M=new t.CP7({canvas:p});M.setSize(u.width,u.height),M.setPixelRatio(Math.min(window.devicePixelRatio,2)),(0,o.Rs)(u,m,M),p.addEventListener("mousemove",S),p.addEventListener("mouseup",S);let b=0,z=()=>{requestAnimationFrame(z),10===b&&(b=0,C()),b++,M.render(g,m)};return z(),(e=>{let a=new l.XS;a.add(D,"count",100,1e5,100).onFinishChange(e),a.add(D,"size",.001,.1,.001).onFinishChange(e),a.add(D,"radius",.01,20,.01).onFinishChange(e),a.add(D,"randomness",0,2,.001).onFinishChange(e),a.add(D,"randomnessPower",1,10,.001).onFinishChange(e),a.addColor(D,"sceneColor").onFinishChange(()=>{g.background=new t.Ilk(D.sceneColor),w()}),a.addColor(D,"player0Color").onFinishChange(()=>{D.playerColor[0]=D.player0Color,D.playerTouchColor[0]=(0,o.zX)(D.player0Color,70),console.log(D.playerTouchColor[0]),w()}),a.addColor(D,"player1Color").onFinishChange(()=>{D.playerColor[1]=D.player1Color,D.playerTouchColor[1]=(0,o.zX)(D.player1Color,70),w()}),a.addColor(D,"player2Color").onFinishChange(()=>{D.playerColor[2]=D.player2Color,D.playerTouchColor[2]=(0,o.zX)(D.player2Color,70),w()}),a.addColor(D,"player3Color").onFinishChange(()=>{D.playerColor[3]=D.player0Color,D.playerTouchColor[3]=(0,o.zX)(D.player3Color,70),w()}),a.close()})(w),()=>{console.log("进行清理"),p.removeEventListener("mousemove",S),p.removeEventListener("mouseup",S),M.clear}},[]),(0,r.jsx)("canvas",{id:"mainCanvas",className:"webgl"}));a.default=y}}]);