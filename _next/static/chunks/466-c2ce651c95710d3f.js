"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[466],{5970:function(e,a,n){n.d(a,{Rs:function(){return r},ey:function(){return s},is:function(){return l},zX:function(){return o}});let r=(e,a,n)=>{window.addEventListener("resize",()=>{console.log("resize"),e.width=window.innerWidth,e.height=window.innerHeight,a.aspect=e.width/e.height,a.updateProjectionMatrix(),n.setSize(e.width,e.height),n.setPixelRatio(Math.min(window.devicePixelRatio,2))})},t=e=>{let a=document.fullscreenElement||document.webkitFullscreenElement;a?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen()},s=e=>{window.addEventListener("dblclick",()=>{t(e)})},l=(e,a)=>{let n=Math.min(e,a);return Math.random()*(Math.max(e,a)-n)+n};function o(e,a){var n=!1;"#"==e[0]&&(e=e.slice(1),n=!0);var r=parseInt(e,16),t=(r>>16)+a;t>255?t=255:t<0&&(t=0);var s=(r>>8&255)+a;s>255?s=255:s<0&&(s=0);var l=(255&r)+a;return l>255?l=255:l<0&&(l=0),(n?"#":"")+(l|s<<8|t<<16).toString(16)}},4261:function(e,a,n){n.r(a),n.d(a,{StarBoard:function(){return r},StarChannel:function(){return t},StarRoute:function(){return s},chessData:function(){return d},default:function(){return c},dicePosiston:function(){return l},gameData:function(){return i},homeIndex:function(){return o}});let r=[{index:0,x:85,y:63,angle:270,player:3,chess:[]},{index:1,x:79,y:65,angle:270,player:0,chess:[]},{index:2,x:73.5,y:65,angle:270,player:1,chess:[]},{index:3,x:67.5,y:63,angle:270,player:2,chess:[]},{index:4,x:63,y:67.5,angle:180,player:3,chess:[]},{index:5,x:65,y:73.5,angle:180,player:0,chess:[]},{index:6,x:65,y:79,angle:180,player:1,chess:[]},{index:7,x:63,y:85,angle:180,player:2,chess:[]},{index:8,x:57,y:87,angle:270,player:3,chess:[]},{index:9,x:51.5,y:87,angle:270,player:0,chess:[]},{index:10,x:46,y:87,angle:270,player:1,chess:[]},{index:11,x:40.5,y:87,angle:270,player:2,chess:[]},{index:12,x:35,y:87,angle:270,player:3,chess:[]},{index:13,x:29.5,y:85,angle:0,player:0,chess:[]},{index:14,x:27,y:79,angle:0,player:1,chess:[]},{index:15,x:27,y:73.5,angle:0,player:2,chess:[]},{index:16,x:29.5,y:68,angle:0,player:3,chess:[]},{index:17,x:24.5,y:63,angle:270,player:0,chess:[]},{index:18,x:18.5,y:65,angle:270,player:1,chess:[]},{index:19,x:13,y:65,angle:270,player:2,chess:[]},{index:20,x:7.5,y:62.5,angle:270,player:3,chess:[]},{index:21,x:5.5,y:57,angle:0,player:0,chess:[]},{index:22,x:5.5,y:51.5,angle:0,player:1,chess:[]},{index:23,x:5.5,y:46.5,angle:0,player:2,chess:[]},{index:24,x:5.5,y:41,angle:0,player:3,chess:[]},{index:25,x:5.5,y:35.5,angle:0,player:0,chess:[]},{index:26,x:7.5,y:29.5,angle:90,player:1,chess:[]},{index:27,x:13,y:27.5,angle:90,player:2,chess:[]},{index:28,x:18.5,y:27.5,angle:90,player:3,chess:[]},{index:29,x:24.5,y:29.5,angle:90,player:0,chess:[]},{index:30,x:29.5,y:25,angle:0,player:1,chess:[]},{index:31,x:27,y:19,angle:0,player:2,chess:[]},{index:32,x:27,y:13.5,angle:0,player:3,chess:[]},{index:33,x:29,y:7.5,angle:0,player:0,chess:[]},{index:34,x:35,y:5.5,angle:90,player:1,chess:[]},{index:35,x:41,y:5.5,angle:90,player:2,chess:[]},{index:36,x:46,y:5.5,angle:90,player:3,chess:[]},{index:37,x:51.5,y:5.5,angle:90,player:0,chess:[]},{index:38,x:57,y:5.5,angle:90,player:1,chess:[]},{index:39,x:63,y:7.5,angle:180,player:2,chess:[]},{index:40,x:65,y:13.5,angle:180,player:3,chess:[]},{index:41,x:65,y:19,angle:180,player:0,chess:[]},{index:42,x:63,y:25,angle:180,player:1,chess:[]},{index:43,x:67.5,y:29.5,angle:90,player:2,chess:[]},{index:44,x:73.5,y:27.5,angle:90,player:3,chess:[]},{index:45,x:79,y:27.5,angle:90,player:0,chess:[]},{index:46,x:85,y:29.5,angle:90,player:1,chess:[]},{index:47,x:87,y:35.5,angle:180,player:2,chess:[]},{index:48,x:87,y:41,angle:180,player:3,chess:[]},{index:49,x:87,y:46,angle:180,player:0,chess:[]},{index:50,x:87,y:51.5,angle:180,player:1,chess:[]},{index:51,x:87,y:57,angle:180,player:2,chess:[]},{index:52,x:79,y:46,angle:270,player:0,chess:[]},{index:53,x:73.5,y:46,angle:270,player:0,chess:[]},{index:54,x:68,y:46,angle:270,player:0,chess:[]},{index:55,x:62.5,y:46,angle:270,player:0,chess:[]},{index:56,x:57,y:46,angle:270,player:0,chess:[]},{index:57,x:51.5,y:46,angle:270,player:0,chess:[]},{index:58,x:46.2,y:79,angle:0,player:1,chess:[]},{index:59,x:46.2,y:73.5,angle:0,player:1,chess:[]},{index:60,x:46.2,y:68,angle:0,player:1,chess:[]},{index:61,x:46.2,y:62.5,angle:0,player:1,chess:[]},{index:62,x:46.2,y:57.3,angle:0,player:1,chess:[]},{index:63,x:46.2,y:51.5,angle:0,player:1,chess:[]},{index:64,x:13.3,y:46,angle:90,player:2,chess:[]},{index:65,x:18.7,y:46,angle:90,player:2,chess:[]},{index:66,x:24,y:46,angle:90,player:2,chess:[]},{index:67,x:29.7,y:46,angle:90,player:2,chess:[]},{index:68,x:35,y:46,angle:90,player:2,chess:[]},{index:69,x:41,y:46,angle:90,player:2,chess:[]},{index:70,x:46.2,y:13.5,angle:180,player:3,chess:[]},{index:71,x:46.2,y:18.7,angle:180,player:3,chess:[]},{index:72,x:46.2,y:24.1,angle:180,player:3,chess:[]},{index:73,x:46.2,y:29.5,angle:180,player:3,chess:[]},{index:74,x:46.2,y:35,angle:180,player:3,chess:[]},{index:75,x:46.2,y:41,angle:180,player:3,chess:[]},{index:76,x:92.5,y:66.8,angle:270,player:0,chess:[]},{index:77,x:78.15,y:78.35,angle:270,player:0,chess:[]},{index:78,x:78.15,y:86.6,angle:270,player:0,chess:[]},{index:79,x:86.65,y:78.35,angle:270,player:0,chess:[]},{index:80,x:86.55,y:86.5,angle:270,player:0,chess:[]},{index:81,x:25.5,y:92.5,angle:0,player:1,chess:[]},{index:82,x:5.8,y:78.2,angle:0,player:1,chess:[]},{index:83,x:5.8,y:86.5,angle:0,player:1,chess:[]},{index:84,x:14.1,y:78.1,angle:0,player:1,chess:[]},{index:85,x:14.1,y:86.4,angle:0,player:1,chess:[]},{index:86,x:0,y:25.6,angle:90,player:2,chess:[]},{index:87,x:5.7,y:5.8,angle:90,player:2,chess:[]},{index:88,x:5.7,y:13.9,angle:90,player:2,chess:[]},{index:89,x:14.1,y:5.8,angle:90,player:2,chess:[]},{index:90,x:14.1,y:13.8,angle:90,player:2,chess:[]},{index:91,x:66.8,y:0,angle:180,player:3,chess:[]},{index:92,x:78.3,y:5.6,angle:180,player:3,chess:[]},{index:93,x:78.3,y:14.1,angle:180,player:3,chess:[]},{index:94,x:86.55,y:5.6,angle:180,player:3,chess:[]},{index:95,x:86.45,y:14.1,angle:180,player:3,chess:[]}],t=[[17,30,43,4],[29,42,3,16]],s=[[76,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,52,53,54,55,56,57],[81,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,1,2,3,4,5,6,7,8,9,10,58,59,60,61,62,63],[86,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,64,65,66,67,68,69],[91,39,40,41,42,43,44,45,46,47,48,49,50,51,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,70,71,72,73,74,75]],l=[{x:.4,y:.8},{x:-1.8,y:.8},{x:-1.8,y:-1.2},{x:.4,y:-1.2}],o=[77,78,79,80,82,83,84,85,87,88,89,90,92,93,94,95],i={state:"start",currentPlayer:0,dice:0,round:0,currentStar:-1,touchStar:-1},d=[{index:77,player:0,state:"home"},{index:78,player:0,state:"home"},{index:79,player:0,state:"home"},{index:80,player:0,state:"home"},{index:82,player:1,state:"home"},{index:83,player:1,state:"home"},{index:84,player:1,state:"home"},{index:85,player:1,state:"home"},{index:87,player:2,state:"home"},{index:88,player:2,state:"home"},{index:89,player:2,state:"home"},{index:90,player:2,state:"home"},{index:92,player:3,state:"home"},{index:93,player:3,state:"home"},{index:94,player:3,state:"home"},{index:95,player:3,state:"home"}];function c(){}},2466:function(e,a,n){n.r(a);var r=n(5893),t=n(9477),s=n(9365),l=n(7637),o=n(5970),i=n(7294),d=n(4261);let c=()=>(console.log("StarFlyChess"),(0,i.useEffect)(()=>{let e,a,n,r,i,c,y,h,x,p,g;console.log("useEffect");let u=document.querySelector("#mainCanvas"),m=new t.xsS,D={width:window.innerWidth,height:window.innerHeight},f=new t.cPb(75,D.width/D.height,.1,100);f.position.set(0,0,8);let C=new s.z(f,u);C.enablePan=!1;let w={isLockCamara:!1,count:500,size:.02,radius:3,randomness:.2,randomnessPower:4,sceneColor:"#000000",player0Color:"#ff6030",player1Color:"#3de93a",player2Color:"#ffbb00",player3Color:"#0062ff",playerColor:["#ff6030","#3de93a","#ffbb00","#0062ff"],playerTouchColor:[(0,o.zX)("#ff6030",70),(0,o.zX)("#3de93a",70),(0,o.zX)("#ffbb00",70),(0,o.zX)("#0062ff",70)]};m.background=new t.Ilk(w.sceneColor);let S=new t.Ilk("#ffffff");function P(){n&&(e.dispose(),a.dispose(),m.remove(n)),e=new t.u9r;var r=d.StarBoard.length;let s=new Float32Array(w.count*(r+4)*3),l=new Float32Array(w.count*(r+4)*3);for(let e=0;e<r;e++)for(let a=0;a<w.count;a++){let n=(e*w.count+a)*3,r=new t.Ilk(w.playerColor[d.StarBoard[e].player]);r.lerp(S,(0,o.is)(0,.1)),a%2==0?(s[n]=d.StarBoard[e].x/10-5+(0,o.is)(0,.3)*(.5>Math.random()?1:-1),s[n+1]=d.StarBoard[e].y/10-5+(0,o.is)(.22,.3)*(.5>Math.random()?1:-1)):(s[n]=d.StarBoard[e].x/10-5+(0,o.is)(.22,.3)*(.5>Math.random()?1:-1),s[n+1]=d.StarBoard[e].y/10-5+(0,o.is)(0,.3)*(.5>Math.random()?1:-1)),s[n+2]=0,l[n]=r.r,l[n+1]=r.g,l[n+2]=r.b}for(let e=0;e<4;e++)for(let a=0;a<w.count;a++){let n=((e+r)*w.count+a)*3,i=new t.Ilk(w.playerColor[e]);if(d.StarBoard[d.StarChannel[0][e]].x===d.StarBoard[d.StarChannel[1][e]].x){s[n]=d.StarBoard[d.StarChannel[0][e]].x/10-5+(0,o.is)(-.2,.2);let a=d.StarBoard[d.StarChannel[0][e]].y/10-5,r=d.StarBoard[d.StarChannel[1][e]].y/10-5;s[n+1]=(0,o.is)(a+(a<0?.3:-.3),r+(r<0?.3:-.3)),i.lerp(S,1-Math.abs(2*s[n+1]/(a-r)))}else{let a=d.StarBoard[d.StarChannel[0][e]].x/10-5,r=d.StarBoard[d.StarChannel[1][e]].x/10-5;s[n]=(0,o.is)(a+(a<0?.3:-.3),r+(r<0?.3:-.3)),s[n+1]=d.StarBoard[d.StarChannel[0][e]].y/10-5+(0,o.is)(-.2,.2),i.lerp(S,1-Math.abs(2*s[n]/(a-r)))}s[n+2]=Math.random()**w.randomnessPower*(.5>Math.random()?1:-1)*w.randomness*Math.random()*w.radius,l[n]=i.r,l[n+1]=i.g,l[n+2]=i.b}e.setAttribute("position",new t.TlE(s,3)),e.setAttribute("color",new t.TlE(l,3)),a=new t.UY4({size:w.size,sizeAttenuation:!0,depthWrite:!1,blending:t.WMw,vertexColors:!0}),n=new t.woe(e,a),m.add(n)}function b(){c&&(r.dispose(),i.dispose(),m.remove(c)),r=new t.u9r;let e=new Float32Array(48*w.count),a=new Float32Array(48*w.count);for(let n=0;n<16;n++)for(let r=0;r<w.count;r++){let s=(n*w.count+r)*3,l=Math.random()*w.radius,i=new t.Ilk(w.playerColor[d.chessData[n].player]);"end"===d.chessData[n].state?i.lerp(S,1):d.gameData.touchStar===n?i.lerp(new t.Ilk(w.playerTouchColor[d.chessData[n].player]),1):i.lerp(S,(0,o.is)(0,.1)),e[s]=d.StarBoard[d.chessData[n].index].x/10-5+Math.random()**w.randomnessPower*(.5>Math.random()?1:-1)*w.randomness*l/2,e[s+1]=d.StarBoard[d.chessData[n].index].y/10-5+Math.random()**w.randomnessPower*(.5>Math.random()?1:-1)*w.randomness*l/2,e[s+2]=Math.random()**w.randomnessPower*(.5>Math.random()?1:-1)*w.randomness*l/3,a[s]=i.r,a[s+1]=i.g,a[s+2]=i.b}r.setAttribute("position",new t.TlE(e,3)),r.setAttribute("color",new t.TlE(a,3)),i=new t.UY4({size:w.size,sizeAttenuation:!0,depthWrite:!1,blending:t.WMw,vertexColors:!0}),c=new t.woe(r,i),m.add(c)}function M(){x&&(y.dispose(),h.dispose(),m.remove(x)),y=new t.u9r;let e=new Float32Array(18*w.count),a=new Float32Array(18*w.count),n="dice"===d.gameData.state?Math.floor((0,o.is)(1,7)):d.gameData.dice;for(let r=0;r<n;r++)for(let n=0;n<w.count;n++){let s=(r*w.count+n)*3,l=Math.random()*w.radius,i=new t.Ilk(w.playerColor[d.gameData.currentPlayer]);i.lerp(S,(0,o.is)(0,.2)),e[s]=d.dicePosiston[d.gameData.currentPlayer].x+(r>2?.4*r-1.2:.4*r)+Math.random()**w.randomnessPower*(.5>Math.random()?1:-1)*w.randomness*l/5,e[s+1]=d.dicePosiston[d.gameData.currentPlayer].y+(r>2?-.4:0)+Math.random()**w.randomnessPower*(.5>Math.random()?1:-1)*w.randomness*l/5,e[s+2]=0,a[s]=i.r,a[s+1]=i.g,a[s+2]=i.b}y.setAttribute("position",new t.TlE(e,3)),y.setAttribute("color",new t.TlE(a,3)),h=new t.UY4({size:w.size,sizeAttenuation:!0,depthWrite:!1,blending:t.WMw,vertexColors:!0}),x=new t.woe(y,h),m.add(x)}function F(e){if("mouseup"===e.type&&"dice"===d.gameData.state){(function(){if(d.gameData.dice=Math.floor((0,o.is)(1,7)),d.gameData.state="fly",M(),console.log("投掷完毕，等待p"+d.gameData.currentPlayer+"行棋"),d.gameData.dice<6){let e=0;for(let a=0;a<4;a++)("home"===d.chessData[4*d.gameData.currentPlayer+a].state||"end"===d.chessData[4*d.gameData.currentPlayer+a].state)&&e++;e>3&&(z(0),console.log("p"+d.gameData.currentPlayer+"不可行棋"))}})();return}let a=-((e.clientX-u.clientWidth/2)/(u.clientHeight/2)*(f.position.z/Math.tan(90-f.getEffectiveFOV()/2))),n=-(-(e.clientY-u.clientHeight/2)/(u.clientHeight/2)*(f.position.z/Math.tan(90-f.getEffectiveFOV()/2)));d.gameData.touchStar=-1;for(let r=0;r<16;r++){let t=d.StarBoard[d.chessData[r].index].x/10-5,s=d.StarBoard[d.chessData[r].index].y/10-5;a<t+.3&&a>t-.3&&n<s+.3&&n>s-.3&&(d.gameData.touchStar=r,"mouseup"===e.type&&"fly"===d.gameData.state&&function(e){if(d.chessData[e].player!==d.gameData.currentPlayer||"end"===d.chessData[e].state){console.log("棋子不可行动");return}if("home"===d.chessData[e].state){if(6===d.gameData.dice)d.chessData[e].index=d.StarRoute[d.gameData.currentPlayer][0],d.chessData[e].state="start",d.gameData.state="dice",R(),console.log("等待p"+d.gameData.currentPlayer+"再次投骰子");else{console.log("棋子不可行动");return}}else{let a=d.StarRoute[d.gameData.currentPlayer].length,n=d.StarRoute[d.gameData.currentPlayer].indexOf(d.chessData[e].index)+d.gameData.dice;d.chessData[e].state="fly",n>a?(console.log(d.chessData[e]),d.chessData[e].state="end",d.chessData[e].index=d.homeIndex[e],console.log(d.chessData[e])):(d.chessData[e].index=d.StarRoute[d.gameData.currentPlayer][n],d.chessData[e].index===d.StarChannel[0][d.chessData[e].player]?(d.chessData[e].index=d.StarChannel[1][d.chessData[e].player],d.chessData[e].index<52&&d.StarBoard[d.chessData[e].index].player===d.chessData[e].player&&(d.chessData[e].index=d.StarRoute[d.gameData.currentPlayer][d.StarRoute[d.gameData.currentPlayer].indexOf(d.chessData[e].index)+4])):d.chessData[e].index<52&&d.StarBoard[d.chessData[e].index].player===d.chessData[e].player&&(d.chessData[e].index=d.StarRoute[d.gameData.currentPlayer][d.StarRoute[d.gameData.currentPlayer].indexOf(d.chessData[e].index)+4],d.chessData[e].index===d.StarChannel[0][d.chessData[e].player]&&(d.chessData[e].index=d.StarChannel[1][d.chessData[e].player])));for(let a=0;a<16;a++)d.chessData[a].player!==d.gameData.currentPlayer&&d.chessData[a].index===d.chessData[e].index&&(console.log("p"+d.gameData.currentPlayer+"击毁p"+d.chessData[a].player+"的棋子"),d.chessData[a].index=d.homeIndex[a]);d.gameData.dice<6||v()?z(0):(d.gameData.state="dice",R(),console.log("等待p"+d.gameData.currentPlayer+"再次投骰子"))}b()}(r))}}function v(){let e=0;for(let a=0;a<4;a++)"end"===d.chessData[4*d.gameData.currentPlayer+a].state&&e++;return e>3}function z(e){e>3&&(console.log("游戏结束！"),d.gameData.state="end"),d.gameData.state="dice",R(),d.gameData.currentPlayer++,d.gameData.currentPlayer>3&&(d.gameData.currentPlayer=0,d.gameData.round++),v()&&z(e),console.log("等待p"+d.gameData.currentPlayer+"投骰子")}P(),b(),d.gameData.state="dice";let k=new t.CP7({canvas:u});k.setSize(D.width,D.height),k.setPixelRatio(Math.min(window.devicePixelRatio,2)),(0,o.Rs)(D,f,k),u.addEventListener("mousemove",F),u.addEventListener("mouseup",F);let B=0,E=()=>{cancelAnimationFrame(p),p=requestAnimationFrame(E),10===B&&(B=0,b()),B++,k.render(m,f)};E();let A=0,R=()=>{cancelAnimationFrame(g),"dice"==d.gameData.state&&(g=requestAnimationFrame(R),30===A&&(A=0,M()),A++,k.render(m,f))};return R(),(e=>{let a=new l.XS;a.add(w,"isLockCamara",100,1e5,100).onFinishChange(()=>{w.isLockCamara?(C.enableRotate=!1,C.reset()):C.enableRotate=!0}),a.add(w,"count",100,1e5,100).onFinishChange(e),a.add(w,"size",.001,.1,.001).onFinishChange(e),a.add(w,"radius",.01,20,.01).onFinishChange(e),a.add(w,"randomness",0,2,.001).onFinishChange(e),a.add(w,"randomnessPower",1,10,.001).onFinishChange(e),a.addColor(w,"sceneColor").onFinishChange(()=>{m.background=new t.Ilk(w.sceneColor),P()}),a.addColor(w,"player0Color").onFinishChange(()=>{w.playerColor[0]=w.player0Color,w.playerTouchColor[0]=(0,o.zX)(w.player0Color,70),console.log(w.playerTouchColor[0]),P()}),a.addColor(w,"player1Color").onFinishChange(()=>{w.playerColor[1]=w.player1Color,w.playerTouchColor[1]=(0,o.zX)(w.player1Color,70),P()}),a.addColor(w,"player2Color").onFinishChange(()=>{w.playerColor[2]=w.player2Color,w.playerTouchColor[2]=(0,o.zX)(w.player2Color,70),P()}),a.addColor(w,"player3Color").onFinishChange(()=>{w.playerColor[3]=w.player0Color,w.playerTouchColor[3]=(0,o.zX)(w.player3Color,70),P()}),a.close()})(P),()=>{console.log("进行清理"),u.removeEventListener("mousemove",F),u.removeEventListener("mouseup",F),k.clear}},[]),(0,r.jsx)("canvas",{id:"mainCanvas",className:"webgl"}));a.default=c}}]);