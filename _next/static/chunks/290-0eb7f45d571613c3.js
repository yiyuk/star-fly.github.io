"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[290],{5970:function(e,a,n){n.d(a,{Rs:function(){return t},ey:function(){return s},is:function(){return l},zX:function(){return o}});let t=(e,a,n)=>{window.addEventListener("resize",()=>{console.log("resize"),e.width=window.innerWidth,e.height=window.innerHeight,a.aspect=e.width/e.height,a.updateProjectionMatrix(),n.setSize(e.width,e.height),n.setPixelRatio(Math.min(window.devicePixelRatio,2))})},r=e=>{let a=document.fullscreenElement||document.webkitFullscreenElement;a?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen()},s=e=>{window.addEventListener("dblclick",()=>{r(e)})},l=(e,a)=>{let n=Math.min(e,a);return Math.random()*(Math.max(e,a)-n)+n};function o(e,a){var n=!1;"#"==e[0]&&(e=e.slice(1),n=!0);var t=parseInt(e,16),r=(t>>16)+a;r>255?r=255:r<0&&(r=0);var s=(t>>8&255)+a;s>255?s=255:s<0&&(s=0);var l=(255&t)+a;return l>255?l=255:l<0&&(l=0),(n?"#":"")+(l|s<<8|r<<16).toString(16)}},4261:function(e,a,n){n.r(a),n.d(a,{StarBoard:function(){return t},StarChannel:function(){return r},StarRoute:function(){return s},chessData:function(){return d},default:function(){return c},dicePosiston:function(){return l},gameData:function(){return i},homeIndex:function(){return o}});let t=[{index:0,x:85,y:63,angle:270,player:3,chess:[]},{index:1,x:79,y:65,angle:270,player:0,chess:[]},{index:2,x:73.5,y:65,angle:270,player:1,chess:[]},{index:3,x:67.5,y:63,angle:270,player:2,chess:[]},{index:4,x:63,y:67.5,angle:180,player:3,chess:[]},{index:5,x:65,y:73.5,angle:180,player:0,chess:[]},{index:6,x:65,y:79,angle:180,player:1,chess:[]},{index:7,x:63,y:85,angle:180,player:2,chess:[]},{index:8,x:57,y:87,angle:270,player:3,chess:[]},{index:9,x:51.5,y:87,angle:270,player:0,chess:[]},{index:10,x:46,y:87,angle:270,player:1,chess:[]},{index:11,x:40.5,y:87,angle:270,player:2,chess:[]},{index:12,x:35,y:87,angle:270,player:3,chess:[]},{index:13,x:29.5,y:85,angle:0,player:0,chess:[]},{index:14,x:27,y:79,angle:0,player:1,chess:[]},{index:15,x:27,y:73.5,angle:0,player:2,chess:[]},{index:16,x:29.5,y:68,angle:0,player:3,chess:[]},{index:17,x:24.5,y:63,angle:270,player:0,chess:[]},{index:18,x:18.5,y:65,angle:270,player:1,chess:[]},{index:19,x:13,y:65,angle:270,player:2,chess:[]},{index:20,x:7.5,y:62.5,angle:270,player:3,chess:[]},{index:21,x:5.5,y:57,angle:0,player:0,chess:[]},{index:22,x:5.5,y:51.5,angle:0,player:1,chess:[]},{index:23,x:5.5,y:46.5,angle:0,player:2,chess:[]},{index:24,x:5.5,y:41,angle:0,player:3,chess:[]},{index:25,x:5.5,y:35.5,angle:0,player:0,chess:[]},{index:26,x:7.5,y:29.5,angle:90,player:1,chess:[]},{index:27,x:13,y:27.5,angle:90,player:2,chess:[]},{index:28,x:18.5,y:27.5,angle:90,player:3,chess:[]},{index:29,x:24.5,y:29.5,angle:90,player:0,chess:[]},{index:30,x:29.5,y:25,angle:0,player:1,chess:[]},{index:31,x:27,y:19,angle:0,player:2,chess:[]},{index:32,x:27,y:13.5,angle:0,player:3,chess:[]},{index:33,x:29,y:7.5,angle:0,player:0,chess:[]},{index:34,x:35,y:5.5,angle:90,player:1,chess:[]},{index:35,x:41,y:5.5,angle:90,player:2,chess:[]},{index:36,x:46,y:5.5,angle:90,player:3,chess:[]},{index:37,x:51.5,y:5.5,angle:90,player:0,chess:[]},{index:38,x:57,y:5.5,angle:90,player:1,chess:[]},{index:39,x:63,y:7.5,angle:180,player:2,chess:[]},{index:40,x:65,y:13.5,angle:180,player:3,chess:[]},{index:41,x:65,y:19,angle:180,player:0,chess:[]},{index:42,x:63,y:25,angle:180,player:1,chess:[]},{index:43,x:67.5,y:29.5,angle:90,player:2,chess:[]},{index:44,x:73.5,y:27.5,angle:90,player:3,chess:[]},{index:45,x:79,y:27.5,angle:90,player:0,chess:[]},{index:46,x:85,y:29.5,angle:90,player:1,chess:[]},{index:47,x:87,y:35.5,angle:180,player:2,chess:[]},{index:48,x:87,y:41,angle:180,player:3,chess:[]},{index:49,x:87,y:46,angle:180,player:0,chess:[]},{index:50,x:87,y:51.5,angle:180,player:1,chess:[]},{index:51,x:87,y:57,angle:180,player:2,chess:[]},{index:52,x:79,y:46,angle:270,player:0,chess:[]},{index:53,x:73.5,y:46,angle:270,player:0,chess:[]},{index:54,x:68,y:46,angle:270,player:0,chess:[]},{index:55,x:62.5,y:46,angle:270,player:0,chess:[]},{index:56,x:57,y:46,angle:270,player:0,chess:[]},{index:57,x:51.5,y:46,angle:270,player:0,chess:[]},{index:58,x:46.2,y:79,angle:0,player:1,chess:[]},{index:59,x:46.2,y:73.5,angle:0,player:1,chess:[]},{index:60,x:46.2,y:68,angle:0,player:1,chess:[]},{index:61,x:46.2,y:62.5,angle:0,player:1,chess:[]},{index:62,x:46.2,y:57.3,angle:0,player:1,chess:[]},{index:63,x:46.2,y:51.5,angle:0,player:1,chess:[]},{index:64,x:13.3,y:46,angle:90,player:2,chess:[]},{index:65,x:18.7,y:46,angle:90,player:2,chess:[]},{index:66,x:24,y:46,angle:90,player:2,chess:[]},{index:67,x:29.7,y:46,angle:90,player:2,chess:[]},{index:68,x:35,y:46,angle:90,player:2,chess:[]},{index:69,x:41,y:46,angle:90,player:2,chess:[]},{index:70,x:46.2,y:13.5,angle:180,player:3,chess:[]},{index:71,x:46.2,y:18.7,angle:180,player:3,chess:[]},{index:72,x:46.2,y:24.1,angle:180,player:3,chess:[]},{index:73,x:46.2,y:29.5,angle:180,player:3,chess:[]},{index:74,x:46.2,y:35,angle:180,player:3,chess:[]},{index:75,x:46.2,y:41,angle:180,player:3,chess:[]},{index:76,x:92.5,y:66.8,angle:270,player:0,chess:[]},{index:77,x:78.15,y:78.35,angle:270,player:0,chess:[]},{index:78,x:78.15,y:86.6,angle:270,player:0,chess:[]},{index:79,x:86.65,y:78.35,angle:270,player:0,chess:[]},{index:80,x:86.55,y:86.5,angle:270,player:0,chess:[]},{index:81,x:25.5,y:92.5,angle:0,player:1,chess:[]},{index:82,x:5.8,y:78.2,angle:0,player:1,chess:[]},{index:83,x:5.8,y:86.5,angle:0,player:1,chess:[]},{index:84,x:14.1,y:78.1,angle:0,player:1,chess:[]},{index:85,x:14.1,y:86.4,angle:0,player:1,chess:[]},{index:86,x:0,y:25.6,angle:90,player:2,chess:[]},{index:87,x:5.7,y:5.8,angle:90,player:2,chess:[]},{index:88,x:5.7,y:13.9,angle:90,player:2,chess:[]},{index:89,x:14.1,y:5.8,angle:90,player:2,chess:[]},{index:90,x:14.1,y:13.8,angle:90,player:2,chess:[]},{index:91,x:66.8,y:0,angle:180,player:3,chess:[]},{index:92,x:78.3,y:5.6,angle:180,player:3,chess:[]},{index:93,x:78.3,y:14.1,angle:180,player:3,chess:[]},{index:94,x:86.55,y:5.6,angle:180,player:3,chess:[]},{index:95,x:86.45,y:14.1,angle:180,player:3,chess:[]}],r=[[17,30,43,4],[29,42,3,16]],s=[[76,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,52,53,54,55,56,57],[81,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,1,2,3,4,5,6,7,8,9,10,58,59,60,61,62,63],[86,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,64,65,66,67,68,69],[91,39,40,41,42,43,44,45,46,47,48,49,50,51,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,70,71,72,73,74,75]],l=[{x:.4,y:.8},{x:-1.8,y:.8},{x:-1.8,y:-1.2},{x:.4,y:-1.2}],o=[77,78,79,80,82,83,84,85,87,88,89,90,92,93,94,95],i={state:"start",currentPlayer:0,dice:0,round:0,currentStar:-1,touchStar:-1},d=[{index:77,player:0,state:"home"},{index:78,player:0,state:"home"},{index:79,player:0,state:"home"},{index:80,player:0,state:"home"},{index:82,player:1,state:"home"},{index:83,player:1,state:"home"},{index:84,player:1,state:"home"},{index:85,player:1,state:"home"},{index:87,player:2,state:"home"},{index:88,player:2,state:"home"},{index:89,player:2,state:"home"},{index:90,player:2,state:"home"},{index:92,player:3,state:"home"},{index:93,player:3,state:"home"},{index:94,player:3,state:"home"},{index:95,player:3,state:"home"}];function c(){}},1290:function(e,a,n){n.r(a),n.d(a,{default:function(){return p}});var t=n(5893),r=n(9477),s=n(9365);class l extends r.aNw{constructor(e){super(e)}load(e,a,n,t){let s=this,l=new r.hH6(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(e){let n=s.parse(JSON.parse(e));a&&a(n)},n,t)}parse(e){return new o(e)}}class o{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,a=100){let n=[],t=function(e,a,n){let t=Array.from(e),s=a/n.resolution,l=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,o=[],i=0,d=0;for(let e=0;e<t.length;e++){let a=t[e];if("\n"===a)i=0,d-=l;else{let e=function(e,a,n,t,s){let l,o,i,d,c,y,h,x;let p=s.glyphs[e]||s.glyphs["?"];if(!p){console.error('THREE.Font: character "'+e+'" does not exists in font family '+s.familyName+".");return}let u=new r.T_1;if(p.o){let e=p._cachedOutline||(p._cachedOutline=p.o.split(" "));for(let r=0,s=e.length;r<s;){let s=e[r++];switch(s){case"m":l=e[r++]*a+n,o=e[r++]*a+t,u.moveTo(l,o);break;case"l":l=e[r++]*a+n,o=e[r++]*a+t,u.lineTo(l,o);break;case"q":i=e[r++]*a+n,d=e[r++]*a+t,c=e[r++]*a+n,y=e[r++]*a+t,u.quadraticCurveTo(c,y,i,d);break;case"b":i=e[r++]*a+n,d=e[r++]*a+t,c=e[r++]*a+n,y=e[r++]*a+t,h=e[r++]*a+n,x=e[r++]*a+t,u.bezierCurveTo(c,y,h,x,i,d)}}}return{offsetX:p.ha*a,path:u}}(a,s,i,d,n);i+=e.offsetX,o.push(e.path)}}return o}(e,a,this.data);for(let e=0,a=t.length;e<a;e++)n.push(...t[e].toShapes());return n}}class i extends r.O7d{constructor(e,a={}){let n=a.font;if(void 0===n)super();else{let t=n.generateShapes(e,a.size);a.depth=void 0!==a.height?a.height:50,void 0===a.bevelThickness&&(a.bevelThickness=10),void 0===a.bevelSize&&(a.bevelSize=8),void 0===a.bevelEnabled&&(a.bevelEnabled=!1),super(t,a)}this.type="TextGeometry"}}var d=n(7637),c=n(5970),y=n(7294),h=n(4261);let x=()=>(console.log("StarFlyChess"),(0,y.useEffect)(()=>{let e,a,n,t,o,y,x,p,u,g,m,f,D;console.log("useEffect");let w=document.querySelector("#mainCanvas"),C=new r.xsS,S={width:window.innerWidth,height:window.innerHeight},b=new r.cPb(75,S.width/S.height,.1,100);b.position.set(0,0,8);let v=new s.z(b,w),P=[],F={isLockCamara:!1,count:500,size:.02,radius:3,randomness:.2,randomnessPower:4,isDrawRound:!1,starJumpTime:500,sceneColor:"#000000",player0Color:"#ff6030",player1Color:"#3de93a",player2Color:"#ffbb00",player3Color:"#0062ff",playerColor:["#ff3c2e","#3de93a","#fffb00","#0062ff"],playerTouchColor:[(0,c.zX)("#ff3c2e",70),(0,c.zX)("#3de93a",70),(0,c.zX)("#fffb00",70),(0,c.zX)("#0062ff",70)]};C.background=new r.Ilk(F.sceneColor);let z=new r.Ilk("#ffffff");function T(){n&&(e.dispose(),a.dispose(),C.remove(n)),e=new r.u9r;var t=h.StarBoard.length;let s=new Float32Array(F.count*(t+4)*3),l=new Float32Array(F.count*(t+4)*3);for(let e=0;e<t;e++)for(let a=0;a<F.count;a++){let n=(e*F.count+a)*3,t=new r.Ilk(F.playerColor[h.StarBoard[e].player]);t.lerp(z,(0,c.is)(0,.1)),a%2==0?(s[n]=h.StarBoard[e].x/10-5+(0,c.is)(0,.3)*(.5>Math.random()?1:-1),s[n+1]=h.StarBoard[e].y/10-5+(0,c.is)(.22,.3)*(.5>Math.random()?1:-1)):(s[n]=h.StarBoard[e].x/10-5+(0,c.is)(.22,.3)*(.5>Math.random()?1:-1),s[n+1]=h.StarBoard[e].y/10-5+(0,c.is)(0,.3)*(.5>Math.random()?1:-1)),s[n+2]=0,l[n]=t.r,l[n+1]=t.g,l[n+2]=t.b}for(let e=0;e<4;e++)for(let a=0;a<F.count;a++){let n=((e+t)*F.count+a)*3,o=new r.Ilk(F.playerColor[e]);if(h.StarBoard[h.StarChannel[0][e]].x===h.StarBoard[h.StarChannel[1][e]].x){s[n]=h.StarBoard[h.StarChannel[0][e]].x/10-5+(0,c.is)(-.2,.2);let a=h.StarBoard[h.StarChannel[0][e]].y/10-5,t=h.StarBoard[h.StarChannel[1][e]].y/10-5;s[n+1]=(0,c.is)(a+(a<0?.3:-.3),t+(t<0?.3:-.3)),o.lerp(z,1-Math.abs(2*s[n+1]/(a-t)))}else{let a=h.StarBoard[h.StarChannel[0][e]].x/10-5,t=h.StarBoard[h.StarChannel[1][e]].x/10-5;s[n]=(0,c.is)(a+(a<0?.3:-.3),t+(t<0?.3:-.3)),s[n+1]=h.StarBoard[h.StarChannel[0][e]].y/10-5+(0,c.is)(-.2,.2),o.lerp(z,1-Math.abs(2*s[n]/(a-t)))}s[n+2]=Math.random()**F.randomnessPower*(.5>Math.random()?1:-1)*F.randomness*Math.random()*F.radius,l[n]=o.r,l[n+1]=o.g,l[n+2]=o.b}e.setAttribute("position",new r.TlE(s,3)),e.setAttribute("color",new r.TlE(l,3)),a=new r.UY4({size:F.size,sizeAttenuation:!0,depthWrite:!1,blending:r.WMw,vertexColors:!0}),n=new r.woe(e,a),C.add(n)}function M(){y&&(t.dispose(),o.dispose(),C.remove(y)),t=new r.u9r;let e=new Float32Array(48*F.count),a=new Float32Array(48*F.count);for(let n=0;n<16;n++)for(let t=0;t<F.count;t++){let s=(n*F.count+t)*3,l=Math.random()*F.radius*("fly"===h.gameData.state&&h.gameData.currentPlayer===h.chessData[n].player?2:.5),o=new r.Ilk(F.playerColor[h.chessData[n].player]);"end"===h.chessData[n].state?o.lerp(z,1):h.gameData.touchStar===n?o.lerp(new r.Ilk(F.playerTouchColor[h.chessData[n].player]),1):o.lerp(z,(0,c.is)(0,.1));let i=h.StarBoard[h.chessData[n].index].x,d=h.StarBoard[h.chessData[n].index].y;for(let e=0,a=P.length;e<a;e++)if(n===P[e].chessDateIndex){let a=h.StarBoard[P[e].startIndex],n=h.StarBoard[P[e].endIndex];i=a.x-(a.x-n.x)*P[e].jumpTime/F.starJumpTime,d=a.y-(a.y-n.y)*P[e].jumpTime/F.starJumpTime,P[e].jumpTime++,P[e].jumpTime===F.starJumpTime&&P.splice(e,1);break}e[s]=i/10-5+Math.random()**F.randomnessPower*(.5>Math.random()?1:-1)*F.randomness*l,e[s+1]=d/10-5+Math.random()**F.randomnessPower*(.5>Math.random()?1:-1)*F.randomness*l,e[s+2]=0+Math.random()**F.randomnessPower*(.5>Math.random()?1:-1)*F.randomness*l/3,a[s]=o.r,a[s+1]=o.g,a[s+2]=o.b}t.setAttribute("position",new r.TlE(e,3)),t.setAttribute("color",new r.TlE(a,3)),o=new r.UY4({size:F.size,sizeAttenuation:!0,depthWrite:!1,blending:r.WMw,vertexColors:!0}),y=new r.woe(t,o),C.add(y)}function k(){u&&(x.dispose(),p.dispose(),C.remove(u)),x=new r.u9r;let e=new Float32Array(18*F.count),a=new Float32Array(18*F.count);"dice"===h.gameData.state&&h.gameData.dice++>5&&(h.gameData.dice=1);let n=h.gameData.dice;for(let t=0;t<n;t++)for(let n=0;n<F.count;n++){let s=(t*F.count+n)*3,l=Math.random()*F.radius,o=new r.Ilk(F.playerColor[h.gameData.currentPlayer]);o.lerp(z,(0,c.is)(0,.2)),e[s]=h.dicePosiston[h.gameData.currentPlayer].x+(t>2?.4*t-1.2:.4*t)+Math.random()**F.randomnessPower*(.5>Math.random()?1:-1)*F.randomness*l/5,e[s+1]=h.dicePosiston[h.gameData.currentPlayer].y+(t>2?-.4:0)+Math.random()**F.randomnessPower*(.5>Math.random()?1:-1)*F.randomness*l/5,e[s+2]=0,a[s]=o.r,a[s+1]=o.g,a[s+2]=o.b}x.setAttribute("position",new r.TlE(e,3)),x.setAttribute("color",new r.TlE(a,3)),p=new r.UY4({size:F.size,sizeAttenuation:!0,depthWrite:!1,blending:r.WMw,vertexColors:!0}),u=new r.woe(x,p),C.add(u)}function B(){m&&(g.dispose(),C.remove(m)),new l().load("./fonts/gentilis_bold.typeface.json",function(e){g=new i("Round : "+h.gameData.round,{font:e,size:3,height:.5,curveSegments:4,bevelEnabled:!0,bevelThickness:.1,bevelSize:.1,bevelSegments:3});let a=new r.vBJ({color:F.playerColor[h.gameData.currentPlayer]});a.transparent=!0,a.opacity=.8,(m=new r.Kj0(g,a)).scale.set(.3,.3,.3),m.position.set(-3,5.2,-.1),C.add(m)})}function R(e){if("mouseup"===e.type&&"dice"===h.gameData.state){(function(){if(h.gameData.dice=Math.floor((0,c.is)(1,7)),h.gameData.round<1){let e=0;for(let a=0;a<4;a++)"home"===h.chessData[4*h.gameData.currentPlayer+a].state&&e++;e>3&&(h.gameData.dice=6)}if(h.gameData.state="fly",cancelAnimationFrame(D),k(),console.log("投掷完毕，等待p"+h.gameData.currentPlayer+"行棋"),h.gameData.dice<6){let e=0;for(let a=0;a<4;a++)("home"===h.chessData[4*h.gameData.currentPlayer+a].state||"end"===h.chessData[4*h.gameData.currentPlayer+a].state)&&e++;e>3&&(A(0),console.log("p"+h.gameData.currentPlayer+"不可行棋"))}})();return}h.gameData.touchStar=-1;let a=new r.Pa4,n=new r.Pa4;a.set(e.clientX/w.clientWidth*2-1,-(2*(e.clientY/w.clientHeight))+1,0),a.unproject(b),a.sub(b.position).normalize();let t=(0-b.position.z)/a.z;n.copy(b.position).add(a.multiplyScalar(t));for(let a=0;a<16;a++){let t=h.StarBoard[h.chessData[a].index].x/10-5,r=h.StarBoard[h.chessData[a].index].y/10-5;n.x<t+.4&&n.x>t-.4&&n.y<r+.4&&n.y>r-.4&&(h.gameData.touchStar=a,"mouseup"===e.type&&"fly"===h.gameData.state&&(h.gameData.currentStar=a,function(e){if(h.chessData[e].player!==h.gameData.currentPlayer||"end"===h.chessData[e].state){console.log("棋子不可行动");return}let a=h.chessData[e].index;if("home"===h.chessData[e].state){if(6===h.gameData.dice)h.chessData[e].index=h.StarRoute[h.gameData.currentPlayer][0],h.chessData[e].state="start",h.gameData.state="dice",W(),console.log("等待p"+h.gameData.currentPlayer+"再次投骰子");else{console.log("棋子不可行动");return}}else{let a=h.StarRoute[h.gameData.currentPlayer].length,n=h.StarRoute[h.gameData.currentPlayer].indexOf(h.chessData[e].index)+h.gameData.dice;h.chessData[e].state="fly",n>=a?(h.chessData[e].state="end",h.chessData[e].index=h.homeIndex[e]):(h.chessData[e].index=h.StarRoute[h.gameData.currentPlayer][n],49!==h.chessData[e].index&&36!==h.chessData[e].index&&23!==h.chessData[e].index&&10!==h.chessData[e].index&&(h.chessData[e].index===h.StarChannel[0][h.chessData[e].player]?(h.chessData[e].index=h.StarChannel[1][h.chessData[e].player],h.chessData[e].index<52&&h.StarBoard[h.chessData[e].index].player===h.chessData[e].player&&(h.chessData[e].index=h.StarRoute[h.gameData.currentPlayer][h.StarRoute[h.gameData.currentPlayer].indexOf(h.chessData[e].index)+4])):h.chessData[e].index<52&&h.StarBoard[h.chessData[e].index].player===h.chessData[e].player&&(h.chessData[e].index=h.StarRoute[h.gameData.currentPlayer][h.StarRoute[h.gameData.currentPlayer].indexOf(h.chessData[e].index)+4],h.chessData[e].index===h.StarChannel[0][h.chessData[e].player]&&(h.chessData[e].index=h.StarChannel[1][h.chessData[e].player]))));for(let a=0;a<16;a++)h.chessData[a].player!==h.gameData.currentPlayer&&h.chessData[a].index===h.chessData[e].index&&(console.log("p"+h.gameData.currentPlayer+"击毁p"+h.chessData[a].player+"的棋子"),h.chessData[a].index=h.homeIndex[a],h.chessData[a].state="home");h.gameData.dice<6||E()?A(0):(h.gameData.state="dice",W(),console.log("等待p"+h.gameData.currentPlayer+"再次投骰子"))}let n={startIndex:a,endIndex:h.chessData[e].index,chessDateIndex:e,jumpTime:0};P.push(n),M()}(a)))}}function E(){let e=0;for(let a=0;a<4;a++)"end"===h.chessData[4*h.gameData.currentPlayer+a].state&&e++;return e>3}function A(e){e>3&&(console.log("游戏结束！"),h.gameData.state="end"),h.gameData.state="dice",W(),h.gameData.currentPlayer++,h.gameData.currentPlayer>3&&(h.gameData.currentPlayer=0,h.gameData.round++),E()&&A(e),F.isDrawRound&&B(),console.log("等待p"+h.gameData.currentPlayer+"投骰子")}T(),h.gameData.state="dice";let I=new r.CP7({canvas:w});I.setSize(S.width,S.height),I.setPixelRatio(Math.min(window.devicePixelRatio,2)),(0,c.Rs)(S,b,I),w.addEventListener("mousemove",R),w.addEventListener("mouseup",R);let X=0,j=()=>{f=requestAnimationFrame(j),10===X&&(X=0,M()),X++,I.render(C,b)};j();let q=0,W=()=>{if("dice"!==h.gameData.state){cancelAnimationFrame(D);return}D=requestAnimationFrame(W),15===q&&(q=0,k()),q++,I.render(C,b)};return W(),(e=>{let a=new d.XS;a.add(F,"isLockCamara").onFinishChange(()=>{F.isLockCamara?(v.enableRotate=!1,v.reset()):v.enableRotate=!0}),a.add(F,"isDrawRound").onFinishChange(()=>{F.isDrawRound?B():C.remove(m)}),a.add(F,"count",100,1e5,100).onFinishChange(e),a.add(F,"size",.001,.1,.001).onFinishChange(e),a.add(F,"radius",.01,20,.01).onFinishChange(e),a.add(F,"randomness",0,2,.001).onFinishChange(e),a.add(F,"randomnessPower",1,10,.001).onFinishChange(e),a.add(F,"starJumpTime",100,1e4,1),a.addColor(F,"sceneColor").onFinishChange(()=>{C.background=new r.Ilk(F.sceneColor),T()}),a.addColor(F,"player0Color").onFinishChange(()=>{F.playerColor[0]=F.player0Color,F.playerTouchColor[0]=(0,c.zX)(F.player0Color,70),console.log(F.playerTouchColor[0]),T()}),a.addColor(F,"player1Color").onFinishChange(()=>{F.playerColor[1]=F.player1Color,F.playerTouchColor[1]=(0,c.zX)(F.player1Color,70),T()}),a.addColor(F,"player2Color").onFinishChange(()=>{F.playerColor[2]=F.player2Color,F.playerTouchColor[2]=(0,c.zX)(F.player2Color,70),T()}),a.addColor(F,"player3Color").onFinishChange(()=>{F.playerColor[3]=F.player0Color,F.playerTouchColor[3]=(0,c.zX)(F.player3Color,70),T()}),a.close()})(T),()=>{console.log("清理绑定事件、动画"),w.removeEventListener("mousemove",R),w.removeEventListener("mouseup",R),cancelAnimationFrame(f),cancelAnimationFrame(D),I.clear}},[]),(0,t.jsx)("canvas",{id:"mainCanvas",className:"webgl"}));var p=x}}]);